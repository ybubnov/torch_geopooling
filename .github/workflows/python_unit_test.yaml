name: Python Unit Test

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  pre-commit:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.11'
      - name: Install pre-commit
        run: pip install pre-commit
      - name: Run pre-commit
        run: pre-commit run --all-files --show-diff-on-failure --color=always

  unit-tests:
    strategy:
      matrix:
        python-version: ['3.8'] #, '3.9', '3.10', '3.11', '3.12']
    runs-on: ubuntu-latest

    steps:
    - name: Checkout source code
      uses: actions/checkout@v4

    - name: Setup Python "${{ matrix.python-version }}"
      uses: actions/setup-python@v5
      with:
        python-version: "${{ matrix.python-version }}"

    - name: Compile Python extension
      run: pip install --verbose --editable .

    - name: Run Python unit-tests
      run: pytest -vv -s

  #build_wheels:
  #  name: Build wheels on ${{ matrix.os }}
  #  runs-on: ${{ matrix.os }}
  #  strategy:
  #    matrix:
  #      os: [macos-14]

  #  steps:
  #    - uses: actions/checkout@v4

  #    - name: Build wheels
  #      uses: pypa/cibuildwheel@v2.17.0
  #      env:
  #        MACOSX_DEPLOYMENT_TARGET: '11.0'
